// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},i=[].slice,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};window.D={};n=function(){function s(e,t,n){var r;e==null&&(e=0);t==null&&(t=0);n==null&&(n=0);r=[e,t,n],this.x=r[0],this.y=r[1],this.z=r[2]}var e,t,n,r,i;i=["add","subtract","multiply","divide"];t=function(e){return s[e]=function(t,n){return t.copy()[e](n)}};for(n=0,r=i.length;n<r;n++){e=i[n];t(e)}s.prototype.copy=function(){return new s(this.x,this.y,this.z)};s.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};s.prototype.normalize=function(){var e;e=this.magnitude();e>0&&this.divide(e);return this};s.prototype.limit=function(e){if(this.magnitude()>e){this.normalize();return this.multiply(e)}return this};s.prototype.heading=function(){return-1*Math.atan2(-1*this.y,this.x)};s.prototype.eucl_distance=function(e){var t,n,r;t=this.x-e.x;n=this.y-e.y;r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)};s.prototype.distance=function(e,t){var n,r,i;t==null&&(t=!1);n=Math.abs(this.x-e.x);r=Math.abs(this.y-e.y);i=Math.abs(this.z-e.z);if(t){n=n<t.width/2?n:t.width-n;r=r<t.height/2?r:t.height-r}return Math.sqrt(n*n+r*r+i*i)};s.prototype.subtract=function(e){this.x-=e.x;this.y-=e.y;this.z-=e.z;return this};s.prototype.add=function(e){this.x+=e.x;this.y+=e.y;this.z+=e.z;return this};s.prototype.divide=function(e){var t;t=[this.x/e,this.y/e,this.z/e],this.x=t[0],this.y=t[1],this.z=t[2];return this};s.prototype.multiply=function(e){var t;t=[this.x*e,this.y*e,this.z*e],this.x=t[0],this.y=t[1],this.z=t[2];return this};s.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z};s.prototype.projectOnto=function(e){return e.copy().multiply(this.dot(e))};s.prototype.wrapRelativeTo=function(e,t){var n,r,i,s,o,u;o=this.copy();u={x:"width",y:"height"};for(n in u){i=u[n];r=this[n]-e[n];s=t[i];Math.abs(r)>s/2&&(r>0?o[n]=(s-this[n])*-1:o[n]=this[n]+s)}return o};s.prototype.invalid=function(){return this.x===Infinity||isNaN(this.x)||this.y===Infinity||isNaN(this.y)||this.z===Infinity||isNaN(this.z)};return s}();window.Vector=n;Array.prototype.last=function(){return this[this.length-1]};String.prototype.capitalize=function(){return this.substr(0,1).toUpperCase()+this.substr(1)};Number.prototype.times=function(e){var t,n;for(t=1,n=this.valueOf();1<=n?t<=n:t>=n;1<=n?t++:t--)e()};D.Util=function(){function e(){}e.randomInt=function(e,t){var n,r,i;t==null&&(t=0);n=Math.random();e==null&&(r=[0,e],e=r[0],t=r[1]);e>t&&(i=[t,e],e=i[0],t=i[1]);return Math.floor(n*(t-e+1)+e)};return e}();(function(){var e,t,n,r,i,s,o,u;i=window;u=["ms","moz","webkit","o"];for(s=0,o=u.length;s<o;s++){r=u[s];if(i.requestAnimationFrame)break;i.requestAnimationFrame=i[""+r+"RequestAnimationFrame"];i.cancelAnimationFrame=i[""+r+"CancelAnimationFrame"]||i[""+r+"CancelRequestAnimationFrame"]}if(i.requestAnimationFrame){if(i.cancelAnimationFrame)return;e=i.requestAnimationFrame;t={};i.requestAnimationFrame=function(n){var r;return r=e(function(e){return r in t?delete t[r]:n(e)})};return i.cancelAnimationFrame=function(e){return t[e]=!0}}n=0;i.requestAnimationFrame=function(e){var t;n=Math.max(n+16,t=+(new Date));return i.setTimeout(function(){return e(+(new Date))},n-t)};return i.cancelAnimationFrame=function(e){return clearTimeout(e)}})();(function(e,t){var n,i,s;if(e.addEventListener)return;s=function(e){var n;n=t[e];return t[e]=function(e){return i(e)}};n=function(t,n,r){return(r=this).attachEvent("on"+t,function(t){t=t||e.event;t.preventDefault=t.preventDefault||function(){return t.returnValue=!1};t.stopPropagation=t.stopPropagation||function(){return t.cancelBubble=!0};return n.call(r,t)})};i=function(e,t){if(t=e.length)while(t--)e[t].addEventListener=n;else e.addEventListener=n;return e};i([t,e]);if(r.call(e,"Element")>=0)return e.Element.prototype.addEventListener=n;t.attachEvent("onreadystatechange",function(){return i(t.all)});s("getElementsByTagName");s("getElementById");s("createElement");return i(t.all)})(window,document);console.log=function(){};e={info:function(e){return console.info(e)}};window.C=e;t=function(){function e(){}e.prototype.bind=function(e,t){var n;this._events||(this._events={});(n=this._events)[e]||(n[e]=[]);return this._events[e].push(t)};e.prototype.unbind=function(e,t){this._events||(this._events={});if(this._events[e])return this._events[e].splice(this._events[e].indexOf(t),1)};e.prototype.trigger=function(){var e,t,n,r,s,o,u;n=arguments[0],e=2<=arguments.length?i.call(arguments,1):[];this._events||(this._events={});if(this._events[n]){o=this._events[n];u=[];for(r=0,s=o.length;r<s;r++){t=o[r];u.push(t.apply(this,e))}return u}};return e}();D.Color=function(){function e(){}e.randomRGB=function(){var e,t,n;n=D.Util.randomInt(0,255);t=D.Util.randomInt(0,255);e=D.Util.randomInt(0,255);return[n,t,e]};e.randomRGBA=function(){var e;e=this.randomRGB();e.push(Math.random().toFixed(2));return e};e.randomHexString=function(){return e.rgbToHex(e.randomRGB())};e.rgbToHex=function(e){var t;t="#";t+=Math.floor(e[0]).toString(16);t+=Math.floor(e[1]).toString(16);t+=Math.floor(e[2]).toString(16);return t};e.rgbToString=function(e){return"rgb("+e[0]+", "+e[1]+", "+rgba[2]+")"};e.rgbaToString=function(e){return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};return e}();D.Entity=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}o(t,e);t.prototype.width=null;t.prototype.height=null;t.prototype.x=null;t.prototype.y=null;t.prototype.events={};t.prototype.init=function(e,t,n,r){this.width=e;this.height=t;this.x=n;this.y=r};t.prototype.update=function(e){};t.prototype.clear=function(e){};t.prototype.render=function(e){};t.prototype.bindEvent=function(e,t){events[e].length===0&&(events[e]=[]);return events[e].push(t)};t.prototype.respondsTo=function(e){var t;t="handle"+e.capitalize();return this[t]!=null?!0:!1};t.prototype.handleEvent=function(e,t,n){var r;if(this.respondsTo(e)===!0){r="handle"+e.capitalize();return this[r](t,n)}};return t}(t);D.Circle=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}o(n,t);n.prototype.radius=null;n.prototype.hitTest=function(t){var n,r,i;i=this.radius;i*=i;n=this.x-t.x;r=this.y-t.y;e.info(n*n+(r+r));return i>n*n+(r+r)?!0:!1};n.prototype.render=function(e){var t;t=e.bufferContext;t.strokeStyle="#fff";t.lineWidth=3;t.fillStyle=this.color;t.beginPath();t.arc(this.x,this.y,this.radius,0,Math.PI*2,!0);t.fill();return t.stroke()};return n}(D.Entity);D.GameState=function(){function t(){}var e;e=null;t.get=function(){return e!=null?e:e=new this};t.prototype.entities=[];t.prototype.init=function(){return console.log("Game state init")};t.prototype.cleanup=function(){};t.prototype.pause=function(){};t.prototype.resume=function(){};t.prototype.handleEvent=function(e,t){var r,i,s,o,u,a;if(e.type==="click"){u=this.entities;a=[];for(s=0,o=u.length;s<o;s++){i=u[s];r=new n(e.clientX,e.clientY);i.hitTest(r,t)?a.push(i.handleEvent(e.type,e,t)):a.push(void 0)}return a}};t.prototype.update=function(e){var t,n,r,i;i=this.entities;for(n=0,r=i.length;n<r;n++){t=i[n];t.update(e)}};t.prototype.clear=function(e){var t,n,r,i;i=this.entities;for(n=0,r=i.length;n<r;n++){t=i[n];t.clear(e)}};t.prototype.render=function(e){var t,n,r,i;i=this.entities;for(n=0,r=i.length;n<r;n++){t=i[n];t.render(e)}};t.prototype.changeState=function(e,t){return e.changeState(t)};return t}();D.Game=function(){function n(){}var e,t;t=null;e=function(){function e(e){this.title=e.title||"Untitled Diesel Game";this.container=e.container||document.querySelector("body");this.init();this.bindEvents();console.log("DGame initialized.")}e.prototype.debug=!0;e.prototype.states=[];e.prototype.container=null;e.prototype.canvas=null;e.prototype.context=null;e.prototype.bufferCanvas=null;e.prototype.bufferContext=null;e.prototype.width=null;e.prototype.height=null;e.prototype.init=function(){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.width=this.container.clientWidth;this.height=this.container.clientHeight;this.canvas.width=this.width;this.canvas.height=this.height;this.bufferCanvas=document.createElement("canvas");this.bufferCanvas.width=this.width;this.bufferCanvas.height=this.height;this.bufferContext=this.bufferCanvas.getContext("2d");return this.container.appendChild(this.canvas)};e.prototype.bindEvents=function(){var e,t,n,r,i;t=["click"];i=[];for(n=0,r=t.length;n<r;n++){e=t[n];i.push(this.canvas.addEventListener(e,this.handleEvent.bind(this)))}return i};e.prototype.handleEvent=function(e){return this.states.last().handleEvent(e,this)};e.prototype.changeState=function(e){if(this.states.length>0){this.states.last().cleanup();this.states.pop()}this.states.push(e);return this.states.last().init()};e.prototype.pushState=function(e){this.states.length>0&&this.states.last().pause();this.states.push(e);return this.states.last().init()};e.prototype.popState=function(){if(this.states.length>0){this.states.last().cleanup();this.states.pop()}if(this.states.length>0)return this.states.last().resume()};e.prototype.update=function(){return this.states.last().update(this)};e.prototype.handleEvents=function(){return this.states.last().handleEvents(this)};e.prototype.clear=function(){this.bufferCanvas.width=this.bufferCanvas.width;this.canvas.width=this.canvas.width;return this.states.last().clear(this)};e.prototype.render=function(){var e;if(!this.lastRun){this.lastRun=(new Date).getTime();requestAnimationFrame(this.render.bind(this));return}e=((new Date).getTime()-this.lastRun)/1e3;this.lastRun=(new Date).getTime();this.fps=1/e;requestAnimationFrame(this.render.bind(this));this.update();this.clear();this.states.last().render(this);return this.context.drawImage(this.bufferCanvas,0,0)};e.prototype.run=function(){return this.render()};return e}();n.get=function(n){return t!=null?t:t=new e(n)};return n}()}).call(this);